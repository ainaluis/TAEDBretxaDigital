<?php
	session_start();
?>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Summer school web exercise</title>

<!-- necessary css files -->
<link type="text/css" rel="stylesheet" href="css/cssMain.css">
<link href="css/jquery.ui.core.min.css" rel="stylesheet" type="text/css">
<link href="css/jquery.ui.datepicker.min.css" rel="stylesheet" type="text/css">
<link href="css/jquery-ui.css" rel="stylesheet" type="text/css">
<link href="css/jquery.ui.datepicker.min.css" rel="stylesheet" type="text/css">
<link href="css/validate.css" rel="stylesheet" type="text/css">

<!-- necessary js files -->
<script type="text/javascript" scr="js/jquery.ui-1.10.4.datepicker.min.js"></script>
<script type="text/javascript" src="js/jquery_lib.js"></script>
<script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.js"></script>
<script type="text/javascript" src="js/slider.js"></script>
<script type="text/javascript" src="js/validator.js"></script>
<script src="js/jsMain.js"></script>



<script>

$(document).ready(function(){
	//Functions that define which elements need to be shown at every step during the registration process.
	function step1 (){
		$('#explanation').hide();
		$('#first_form').show();
		$('#second_form').hide();
		$('#third_form').hide();
		$('#log_out').show();
	};

	function step2 (){
		$('#explanation').hide();
		$('#first_form').hide();
		$('#second_form').show();
		$('#third_form').hide();
		$('#log_out').show();
	};

	function step3 (){
		$('#explanation').hide();
		$('#first_form').hide();
		$('#second_form').hide();
		$('#third_form').show();
		$('#log_out').show();
	};

	function dataSaved(num){
		document.getElementById(num).style.backgroundColor = "green";
	}


		//console.log("El nombre ingresado es: " + nombre);
		//document.getElementById("valorVariable").innerHTML = nombre;



	//initial page
	$('#explanation').show();
	$('#first_form').hide();
	$('#second_form').hide();
	$('#third_form').hide();
	$('#log_out').hide();


	//we want to move to the first step registration
	$('#start').click(function(){
		step1();
	});

	//we want to move back to the first step registration
	$('#back1').click(function(){
		step1();
	});

	//we want to move back to the second step registration
	$('#back2').click(function(){
		step2();
		document.getElementById('step1').style.backgroundColor = "green";
	});

	//quit the form
	$('#log_out').click(function(){
		location.href = 'index.php' ;
	});

	//we know at which step we are thanks to the session variable
	if ('<?php echo $_SESSION['step'];?>' == '1'){
		step1();
	}
	if ('<?php echo $_SESSION['step'];?>' == '2'){
		step2();
		dataSaved('step1');
	}
	if ('<?php echo $_SESSION['step'];?>' == '3'){
		step3();
		dataSaved('step1');
		dataSaved('step2');
	}

	//validation of the forms (no empty fiels, type of data correct)
	$('#formstep1').validate();
	$('#formstep2').validate();
	$('#formstep3').validate();
	$('#formstep4').validate();


	$("#date").hide();

	$("#date").datepicker({
		showOn: "button",
		buttonImage: "images/calendar_link.png",
		buttonImageOnly: false,
		dateFormat: "dd-mm-yy",
		changeDay: true,
		changeMonth: true,
		changeYear: true,
		yearRange: "-80:+00",
		altField: "#newdate",
	});

	$("#date, #newdate").change(function(){
		var getBirth = $(this).val();
		$('#loadAgeCalc').load("php_files/getAge.php?dateIn="+getBirth);
	});


});


</script>


</head>

<body id=body>

	<div class="ui-datepicker-multi" id="container">
		<div id="header">
			REGISTRATION FORM
			<p>El valor de la variable es: <span id="valorVariable"></span></p>
			<p>El valor de la variable es: <span id="valorVariable2"></span></p>
		</div>

		<!-- include the sidebar menu-->
		<?php
			include("php_files/sidebar.php");
		?>

		<div id="content">
			<div><img src="images/list.png" id="menu" width="20px" alt="list"></div>
			<div id="container">
				<div id="explanation">
				<h1> Becoming a new member of the database </h1>
				<p> In order to become a new member of the database, you need to follow 3 steps.</p>
				<p> You would be asked to add your details about your personal information, your address and your contact details.</p>
				<input  type="button" id="start" name="start" value="GET STARTED!">
				</div>
				<table class="bordered" border="2" align="center" cellpadding="6" cellspacing="6" id="contactTable">
					<img id="log_out" src="images/log-out.png" width="20px" height="20px" alt=""/>
					<tbody>
						<tr>
							<th id="step1">PERSONAL INFORMATION</th>
							<th id="step2">ADDRESS</th>
							<th id="step3">CONTACT DETAILS</th>
						</tr>
					</tbody>
				</table>

				<!-- include first form. it will only be shown if we are in step 1 of the registration process-->
				<!-- once the form is submitted, all the information is saved in session variables-->
				<form>
			  <label for="nombre">Nombre:</label>
			  <input type="text" id="nombre" name="nombre"><br><br>
			  <input type="button" id = "guardarNombre" value="Enviar" >
				</form>

				<div id="first_form">
					<form action="php_files/savePersonalInformation.php" method="post" id="formstep1" enctype="multipart/form-data">
						<table class="bordered" border="2" align="center" cellpadding="6" cellspacing="6" id="contactTable">
							<tbody>
							<tr>
								<th colspan="4">REGISTER 1. Please add your personal details below</th>
							</tr>
							<tr>
								<td align="right"> First Name </td>
								<td><input name="firstName" type="text" id="firstName" value="" required/></td>
								<td align="right">Last Name</td>
								<td ><input name="lastName" type="text" id="lastName" value="<?php echo $_SESSION['lastName'];?>" required/></td>
							</tr>
							<tr>
								<td align="right">DoB <input type="text" id="date"></td>
								<td><input name="newdate" type="text" id="newdate" value="<?php echo $_SESSION['dob'];?>"  required/></td>
								<td align="right">Age</td>
								<td><input name="age" type="text" id="age" value="<?php echo $_SESSION['age'];?>"  readonly/></td>
							</tr>
							<tr>
								<td align="center" colspan="4"><input type="submit" id="next_address" value="NEXT STEP"> </td>
							</tr>
							</tbody>
						</table>
					</form>
				</div>

				<!-- include second form. it will only be shown if we are in step 2 of the registration process-->
				<!-- once the form is submitted, all the information is saved in session variables-->
				<div id="second_form">
					<form action="php_files/saveAddress.php" method="post" id="formstep2" enctype="multipart/form-data">
						<table class="bordered" border="2" align="center" cellpadding="6" cellspacing="6" id="contactTable">
							<tbody>
								<tr>
									<th colspan="4">REGISTER 2. Please add your address details below</th>
								</tr>
								<tr>
									<td align="right">House name/no</td>
									<td><input name="house_numberName" type="text" id="house_numberName" value="<?php echo $_SESSION['house'];?>" required/></td>
									<td align="right">Street name</td>
									<td><input name="street_name" type="text" id="street_name" value="<?php echo $_SESSION['street'];?>" required/></td>
								</tr>
								<tr>
									<td align="right">City</td>
									<td><input name="city" type="text" id="city" value="<?php echo $_SESSION['city'];?>" required/></td>
									<td align="right">Post Code</td>
									<td><input name="postCode" type="text" id="postCode" value="<?php echo $_SESSION['postcode'];?>" required/></td>
								</tr>
								<tr>
									<td align="center" colspan=2><input name="back" type="button" id="back1" value="BACK"</td>
									<td align="center" colspan=2><input name="next_contact" type="submit" id="next_contact" value="NEXT STEP. CONTACT DETAILS" val="register"> </td>
									<input type="hidden" name="user_Id" id="user_id" value="<?php echo $_SESSION['user_Id']; ?>"/>
								</tr>
							</tbody>
						</table>
					</form>
				</div>

				<!-- include third form. it will only be shown if we are in step 3 of the registration process-->
				<!-- once the form is submitted, all the information is saved in session variables-->
				<div id="third_form">
					<form action="php_files/saveContact.php" method="post" id="formstep3" enctype="multipart/form-data">
						<table class="bordered" border="2" align="center" cellpadding="6" cellspacing="6" id="contactTable">
							<tbody>
								<tr>
									<th colspan="4">REGISTER 3. Please add your contact details below</th>
								</tr>
								<tr>
									<td colspan="2" align="right">Email</td>
									<td colspan="2"><input name="email" type="email" id="email" value="<?php echo $_SESSION['email'];?>" required /></td>
								</tr>
								<tr>
									<td colspan="2" align="right">Telephone Number</td>
									<td colspan="2"><input name="telephone" type="text" id="telephone" value="<?php echo $_SESSION['telephone'];?>" required/></td>

								</tr>
								<tr>
									<td align="center" colspan=2><input name="back" type="button" id="back2" value="BACK"</td>
									<td align="center" colspan=2><input name="finish" type="submit" id="finish" value="FINISH REGISTRATION" val="register"> </td>
									<input type="hidden" name="user_Id" id="user_id" value="<?php echo $_SESSION['user_Id']; ?>"/>
								</tr>
							</tbody>
						</table>
					</form>
				</div>
			</div>
		</div>

		<div id="footer"> Aina Luis Â© - UCL 2022 </div>
		<div id="loadAgeCalc"> </div>

	</div>
</body>
</html>
