<?php
include("php_connect/DB_connect.php");
include("php_files/functions.php");

//constrain the result to the user details just uploaded 
$sql = "SELECT `users`.`user_Id`,`firstName`, `lastName`, `dob`, `age`, `house_numberName`, `street_name`, `city`, `postCode`, `email`, `telephone` FROM `users`, `address`, `contactdetails` WHERE `users`.`user_Id` = `address`.`user_id` AND `users`.`user_Id` = `contactdetails`.`user_id` ORDER BY `users`.`user_Id` ASC";

$result = mysqli_query($conn, $sql);

?>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Summer school web exercise</title>
	
<link type="text/css" rel="stylesheet" href="css/cssMain.css"/>
<script src="js/jquery_lib.js"></script>
<script src="js/jsMain.js"></script>


<script>
$(document).ready(function(){
	//initial situation
	$('.fee').hide();
		
	//hover above the magnifier in order to see the fees of the users
	$('#lupa').hover(function() {
		$('.member').hide();
		$('.fee').show();
    }, function() {
		$('.member').show();
		$('.fee').hide();
    });
	
	//go back to the homepage
	$('#homeLink').click(function(){ location.href = 'index.php' });
}); 
</script>

</head>

<body id="body">
	<div class="ui-datepicker-multi" id="container">
		<div id="header">
			REGISTRATION FORM
		</div>

		<!--include the sidebar menu-->
		<?php
			include("php_files/sidebar.php");
		?>

		<div id="content">
			<div><img src="images/list.png" id="menu" width="20px" alt="list"></div>
			<div id="container">
				<h1> Content of the Database <img id="lupa" src="images/magnifier.png" width="30px" height="30px" alt=""/></h1>

				<div id="dbcontent">
					<!--add the members registered.
					we make use of the result obtained in the sql query at the beginning of the page.
					for each member, we create a new div with its personal information, address and contact details
					and another div for the fees. These last div will only be shown if the magnifier is hovered.-->
					<?php
					while ($row = mysqli_fetch_array($result)){
						echo 
						// creation of the div for the personal information, address and contact details of each member
						"<div id=".$row['user_Id']." class='member'> <h3>".$row['user_Id']." </h3> <br>
						<h2>First Name: </h2>".$row['firstName']."<br>
						<h2>Last name: </h2>".$row['lastName']."<br>
						<h2>DOB: </h2>".$row['dob']."<br>
						<h2>Age: </h2>".$row['age']."<br> <br>
						<h2>House Number: </h2>".$row['house_numberName']."<br>
						<h2>Street Name: </h2>".$row['street_name']."<br>
						<h2>City: </h2>".$row['city']."<br>
						<h2>Postcode: </h2>".$row['postCode']."<br> <br>
						<h2>Email: </h2>".$row['email']."<br>
						<h2>Phone number: </h2>".$row['telephone']."<br> </div>";
						
						//sql query to select the fees of a given user
						$sql_fee = "SELECT `user_Id`,`feePaid`, `datePaid`, `dateDue`
								FROM `fees`
								WHERE `user_Id`= ".$row['user_Id']."
								ORDER BY `feePaid` DESC";
						
						$result_fee = mysqli_query($conn, $sql_fee);
						
						// creation of the div for the fees of a given member
						echo
						"<div id=".$row_fee['user_Id']."f class='fee'>
						<h3>".$row['user_Id']." </h3> <br>
						<h2> Name: </h2>".$row['firstName']." ".$row['lastName']."<br> <br>";
						while ($row_fee = mysqli_fetch_array($result_fee)){
							echo 
							"<h2>Fee Paid: </h2>".$row_fee['feePaid']."<br>
							<h2>Date Paid: </h2>".$row_fee['datePaid']."<br>
							<h2>Date Due: </h2>".$row_fee['dateDue']."<br> <br>";
						}
						$newid = $row_fee['user_Id'].'-'.$row_fee['user_Id'];
						echo
						"</div>";
					}
					?>
				</div>

			  <table border="1" align="center" cellpadding="4" cellspacing="4">
					<tbody>
						<tr>
							<td><span id="homeLink">HOME</span></td>
						</tr>
					</tbody>
				</table>
			</div

		</div>


		<div id="footer"> Aina Luis Â© - UCL 2022 </div>
	
	</div>  

</body>             
</html>             
                    